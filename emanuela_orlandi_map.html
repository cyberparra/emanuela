<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caso Emanuela Orlandi - Mappa Concettuale Interattiva</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: white;
            overflow: hidden;
            height: 100vh;
        }

        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            padding: 15px 30px;
            z-index: 1000;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            font-size: 24px;
            font-weight: 300;
            text-align: center;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .subtitle {
            text-align: center;
            font-size: 12px;
            color: #aaa;
            margin-top: 5px;
        }

        #map-container {
            width: 100%;
            height: 100vh;
            position: relative;
            padding-top: 80px;
        }

        .node {
            cursor: pointer;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
            transition: all 0.3s ease;
        }

        .node:hover {
            filter: drop-shadow(0 6px 12px rgba(0, 0, 0, 0.5));
            transform: scale(1.05);
        }

        .node-circle {
            stroke-width: 3px;
            transition: all 0.3s ease;
        }

        .node-text {
            font-family: 'Segoe UI', sans-serif;
            font-size: 12px;
            font-weight: 500;
            text-anchor: middle;
            dominant-baseline: middle;
            pointer-events: none;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
        }

        .link {
            stroke-opacity: 0.6;
            stroke-width: 2px;
            transition: all 0.3s ease;
        }

        .link:hover {
            stroke-opacity: 1;
            stroke-width: 3px;
        }

        .details-panel {
            position: fixed;
            right: -400px;
            top: 80px;
            width: 380px;
            height: calc(100vh - 80px);
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(15px);
            border-left: 1px solid rgba(255, 255, 255, 0.1);
            padding: 30px;
            overflow-y: auto;
            transition: right 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            z-index: 999;
        }

        .details-panel.open {
            right: 0;
        }

        .details-panel h2 {
            color: #ff6b6b;
            margin-bottom: 20px;
            font-size: 20px;
            font-weight: 600;
            border-bottom: 2px solid rgba(255, 107, 107, 0.3);
            padding-bottom: 10px;
        }

        .details-panel p {
            line-height: 1.6;
            color: #e0e0e0;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: #fff;
            font-size: 24px;
            cursor: pointer;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(255, 107, 107, 0.3);
            transform: rotate(90deg);
        }

        .legend {
            position: fixed;
            bottom: 30px;
            left: 30px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 999;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            font-size: 12px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .controls {
            position: fixed;
            top: 50%;
            left: 30px;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 999;
        }

        .control-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            color: white;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        @media (max-width: 768px) {
            .details-panel {
                width: 100%;
                right: -100%;
            }
            
            .legend {
                left: 10px;
                bottom: 10px;
                padding: 15px;
            }
            
            .controls {
                left: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Il Caso Emanuela Orlandi</h1>
        <div class="subtitle">Mappa Concettuale Interattiva delle Piste di Indagine</div>
    </div>

    <div id="map-container"></div>

    <div class="details-panel" id="details-panel">
        <button class="close-btn" onclick="closeDetails()">&times;</button>
        <div id="details-content"></div>
    </div>

    <div class="legend">
        <div class="legend-item">
            <div class="legend-color" style="background: #ff6b6b;"></div>
            <span>Caso Centrale</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #4ecdc4;"></div>
            <span>Istituzioni</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #45b7d1;"></div>
            <span>Piste Principali</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #f9ca24;"></div>
            <span>Testimoni/Persone</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #f0932b;"></div>
            <span>Eventi</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #eb4d4b;"></div>
            <span>Luoghi</span>
        </div>
    </div>

    <div class="controls">
        <button class="control-btn" onclick="resetZoom()" title="Reset Vista">ðŸŽ¯</button>
        <button class="control-btn" onclick="zoomIn()" title="Zoom In">+</button>
        <button class="control-btn" onclick="zoomOut()" title="Zoom Out">âˆ’</button>
    </div>

    <script>
        // Dati per la mappa concettuale
        const data = {
            nodes: [
                // Nodo centrale
                { id: "emanuela", label: "Emanuela Orlandi\n22 Giugno 1983", type: "central", size: 50 },
                
                // Istituzioni
                { id: "vaticano", label: "Vaticano", type: "institution", size: 40 },
                { id: "papa", label: "Giovanni Paolo II", type: "institution", size: 35 },
                { id: "sisde", label: "SISDE", type: "institution", size: 30 },
                { id: "sismi", label: "SISMI", type: "institution", size: 30 },
                
                // Piste principali
                { id: "ricatto", label: "Teoria del Ricatto", type: "theory", size: 40 },
                { id: "ali_agca", label: "Attentato Papa\nAli AÄŸca", type: "theory", size: 35 },
                { id: "magliana", label: "Banda della Magliana", type: "theory", size: 35 },
                { id: "londra", label: "Pista Inglese\nLondra", type: "theory", size: 35 },
                { id: "bolzano", label: "Pista Bolzano", type: "theory", size: 30 },
                
                // Persone chiave
                { id: "americano", label: "L'Americano\n(Telefonate)", type: "person", size: 30 },
                { id: "egidio", label: "Avv. Gennaro Egidio", type: "person", size: 25 },
                { id: "de_pedis", label: "Enrico De Pedis\n(Renatino)", type: "person", size: 30 },
                { id: "minardi", label: "Sabrina Minardi", type: "person", size: 25 },
                { id: "accetti", label: "Marco Accetti", type: "person", size: 25 },
                { id: "casaroli", label: "Card. Casaroli", type: "person", size: 25 },
                { id: "de_toffenbach", label: "Rudolf de Toffenbach", type: "person", size: 25 },
                { id: "dioguardi", label: "Giuseppe Dioguardi", type: "person", size: 25 },
                
                // Eventi
                { id: "appello_papa", label: "Appello del Papa\n3 Luglio 1983", type: "event", size: 30 },
                { id: "telefonate", label: "Prime Telefonate\n5 Luglio 1983", type: "event", size: 25 },
                { id: "documento_cinque", label: "Documento\n'Cinque Fogli'", type: "event", size: 25 },
                
                // Luoghi
                { id: "sant_apollinare", label: "Chiesa\nSant'Apollinare", type: "location", size: 25 },
                { id: "scuola_musica", label: "Scuola di Musica", type: "location", size: 20 }
            ],
            
            links: [
                // Collegamenti centrali
                { source: "emanuela", target: "vaticano", strength: "strong" },
                { source: "emanuela", target: "ricatto", strength: "strong" },
                { source: "emanuela", target: "magliana", strength: "medium" },
                { source: "emanuela", target: "londra", strength: "medium" },
                { source: "emanuela", target: "bolzano", strength: "medium" },
                
                // Vaticano e collegamenti
                { source: "vaticano", target: "papa", strength: "strong" },
                { source: "vaticano", target: "casaroli", strength: "strong" },
                { source: "vaticano", target: "ricatto", strength: "strong" },
                { source: "papa", target: "appello_papa", strength: "strong" },
                { source: "papa", target: "ali_agca", strength: "medium" },
                
                // Pista ricatto
                { source: "ricatto", target: "ali_agca", strength: "medium" },
                { source: "ricatto", target: "americano", strength: "strong" },
                { source: "americano", target: "telefonate", strength: "strong" },
                { source: "telefonate", target: "casaroli", strength: "medium" },
                
                // Servizi segreti
                { source: "sisde", target: "egidio", strength: "strong" },
                { source: "sismi", target: "de_toffenbach", strength: "strong" },
                { source: "egidio", target: "vaticano", strength: "medium" },
                { source: "de_toffenbach", target: "bolzano", strength: "strong" },
                
                // Banda della Magliana
                { source: "magliana", target: "de_pedis", strength: "strong" },
                { source: "de_pedis", target: "minardi", strength: "strong" },
                { source: "de_pedis", target: "sant_apollinare", strength: "strong" },
                { source: "sant_apollinare", target: "scuola_musica", strength: "medium" },
                { source: "minardi", target: "vaticano", strength: "medium" },
                
                // Pista Londra
                { source: "londra", target: "documento_cinque", strength: "strong" },
                { source: "londra", target: "dioguardi", strength: "medium" },
                { source: "documento_cinque", target: "vaticano", strength: "strong" },
                
                // Altri collegamenti
                { source: "accetti", target: "americano", strength: "weak" },
                { source: "scuola_musica", target: "emanuela", strength: "strong" }
            ]
        };

        // Dettagli per ogni nodo
        const nodeDetails = {
            "emanuela": {
                title: "Emanuela Orlandi",
                content: "Cittadina vaticana di 15 anni, figlia di un dipendente della Gendarmeria Pontificia. Scomparsa il 22 giugno 1983 mentre tornava da una lezione di musica. Il caso diventa internazionale dopo l'appello di Papa Giovanni Paolo II da Piazza San Pietro il 3 luglio 1983."
            },
            "vaticano": {
                title: "Il Ruolo del Vaticano",
                content: "Il Vaticano Ã¨ al centro delle controversie del caso. Secondo Pietro Orlandi e l'avvocato SgrÃ², la Santa Sede avrebbe informazioni non condivise con la Procura di Roma. La mancanza di collaborazione per oltre 42 anni, il rifiuto di consegnare documenti e la gestione autonoma delle informazioni alimentano i sospetti di un coinvolgimento diretto."
            },
            "papa": {
                title: "Giovanni Paolo II",
                content: "Il Papa 'accredita' il sequestro con il suo appello del 3 luglio 1983, parlando esplicitamente di rapimento. Pietro Orlandi crede che il Papa sapesse esattamente cosa fosse successo e abbia scelto di mettere l'immagine dell'istituzione prima della veritÃ , definendo successivamente il caso come 'terrorismo internazionale'."
            },
            "ricatto": {
                title: "Teoria del Ricatto",
                content: "Ipotesi principale secondo cui Emanuela sarebbe oggetto di un ricatto rivolto al Vaticano. Non si tratterebbe di un semplice ricatto criminale per denaro, ma di qualcosa di estremamente grave che il Vaticano 'non vorrebbe mai far uscire' e che mantiene ancora sotto controllo dopo 42 anni."
            },
            "ali_agca": {
                title: "Connessione con Ali AÄŸca",
                content: "Le richieste dei presunti rapitori ruotavano attorno allo scambio con Mehmet Ali AÄŸca, l'attentatore del Papa del 1981. Pietro Orlandi vede questa connessione come un 'depistaggio enorme' utilizzato dal Vaticano per allontanare la veritÃ  e rendere il Papa la 'vittima' invece della famiglia."
            },
            "americano": {
                title: "L'Americano",
                content: "Autore della telefonata cruciale del 5 luglio 1983, fece ascoltare una registrazione con la voce di una ragazza riconosciuta dalla famiglia come Emanuela. La voce sembrava drogata o addormentata. Le analisi forensi ufficiali smentiscono che fosse Marco Accetti."
            },
            "magliana": {
                title: "Banda della Magliana",
                content: "Pista emersa nel 2005 con una telefonata anonima a 'Chi l'ha visto?' che indirizzava verso la chiesa di Sant'Apollinare e Enrico De Pedis. Pietro Orlandi vede questa pista con scetticismo, considerando De Pedis piÃ¹ come 'manovalanza' che come mandante."
            },
            "de_pedis": {
                title: "Enrico De Pedis (Renatino)",
                content: "Capo dei 'Testaccini', sepolto nella chiesa di Sant'Apollinare dopo la morte nel 1990. Aveva stretti legami con ambienti politici e vaticani, inclusi Marcinkus e Casaroli. La sua morte Ã¨ controversa, con la presenza di servizi al momento del decesso."
            },
            "minardi": {
                title: "Sabrina Minardi",
                content: "Amante di Enrico De Pedis, diventata testimone chiave nell'indagine. Ha descritto un episodio in cui avrebbe consegnato una ragazza, creduta Emanuela, a un prelato su una macchina vaticana vicino al Vaticano."
            },
            "londra": {
                title: "Pista Inglese - Londra",
                content: "Rilanciata nel 2017 con i 'cinque fogli' di Emiliano Fittipaldi, documento che suggerirebbe spese sostenute dal Vaticano per Emanuela dal 1983 al 1997, inclusa una permanenza a Londra. Giuseppe Dioguardi ha riferito di una richiesta urgente vaticana per un volo Roma-Londra nell'agosto 1983."
            },
            "bolzano": {
                title: "Pista di Bolzano",
                content: "Testimonianza di una donna che affermava di aver visto una ragazza stordita, identificata come Emanuela, portata in un casolare nell'agosto 1983. La ragazza sarebbe stata prelevata da Rudolf de Toffenbach del SISMI. La pista fu archiviata quando l'indagine stava portando alla luce legami con traffici di minori."
            },
            "egidio": {
                title: "Avvocato Gennaro Egidio",
                content: "Raccomandato dai servizi segreti (SISDE) alla famiglia Orlandi. Il suo ruolo Ã¨ considerato anomalo: collaborava con inquirenti e servizi, partecipava a missioni all'estero, ma non condivideva tutte le informazioni con la famiglia. Era noto al Vaticano per aver lavorato sul caso Calvi."
            },
            "sant_apollinare": {
                title: "Chiesa di Sant'Apollinare",
                content: "Chiesa dove era sepolto Enrico De Pedis, significativa per essere parte dello stesso complesso della scuola di musica di Emanuela e di uffici importanti. La telefonata anonima del 2005 indirizzava proprio verso questo luogo."
            },
            "accetti": {
                title: "Marco Accetti",
                content: "Considerato da Pietro Orlandi un 'mitomane'. Si presentÃ² dichiarando di sapere della vicenda ma non ha fornito riscontri validi. Pietro ritiene piÃ¹ probabile che Accetti, con precedenti legati alla pedopornografia, possa aver avuto un ruolo nella scomparsa di Mirella Gregori."
            }
        };

        // Configurazione D3
        const width = window.innerWidth;
        const height = window.innerHeight - 80;

        const svg = d3.select("#map-container")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

        const g = svg.append("g");

        // Zoom behavior
        const zoom = d3.zoom()
            .scaleExtent([0.3, 3])
            .on("zoom", (event) => {
                g.attr("transform", event.transform);
            });

        svg.call(zoom);

        // Colori per i tipi di nodi
        const nodeColors = {
            central: "#ff6b6b",
            institution: "#4ecdc4",
            theory: "#45b7d1",
            person: "#f9ca24",
            event: "#f0932b",
            location: "#eb4d4b"
        };

        // Colori per la forza dei collegamenti
        const linkColors = {
            strong: "#ff6b6b",
            medium: "#4ecdc4",
            weak: "#95a5a6"
        };

        // Simulazione di forza
        const simulation = d3.forceSimulation(data.nodes)
            .force("link", d3.forceLink(data.links).id(d => d.id).distance(d => {
                const baseDistance = 100;
                if (d.strength === "strong") return baseDistance * 0.8;
                if (d.strength === "medium") return baseDistance * 1.2;
                return baseDistance * 1.5;
            }))
            .force("charge", d3.forceManyBody().strength(-800))
            .force("center", d3.forceCenter(width / 2, height / 2))
            .force("collision", d3.forceCollide().radius(d => d.size + 10));

        // Links
        const link = g.append("g")
            .selectAll("line")
            .data(data.links)
            .enter()
            .append("line")
            .attr("class", "link")
            .attr("stroke", d => linkColors[d.strength])
            .on("mouseover", function(event, d) {
                d3.select(this).attr("stroke-opacity", 1).attr("stroke-width", 4);
            })
            .on("mouseout", function(event, d) {
                d3.select(this).attr("stroke-opacity", 0.6).attr("stroke-width", 2);
            });

        // Nodes
        const node = g.append("g")
            .selectAll("g")
            .data(data.nodes)
            .enter()
            .append("g")
            .attr("class", "node")
            .call(d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended))
            .on("click", function(event, d) {
                showDetails(d);
            });

        // Cerchi dei nodi
        node.append("circle")
            .attr("class", "node-circle")
            .attr("r", d => d.size)
            .attr("fill", d => nodeColors[d.type])
            .attr("stroke", "#fff");

        // Testo dei nodi
        node.append("text")
            .attr("class", "node-text")
            .text(d => d.label)
            .attr("fill", "white")
            .style("font-size", d => Math.max(10, d.size / 4) + "px");

        // Aggiornamento posizioni
        simulation.on("tick", () => {
            link
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);

            node
                .attr("transform", d => `translate(${d.x},${d.y})`);
        });

        // Funzioni di drag
        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }

        // Funzioni per i dettagli
        function showDetails(node) {
            const panel = document.getElementById("details-panel");
            const content = document.getElementById("details-content");
            
            const details = nodeDetails[node.id];
            if (details) {
                content.innerHTML = `
                    <h2>${details.title}</h2>
                    <p>${details.content}</p>
                `;
                panel.classList.add("open");
            }
        }

        function closeDetails() {
            document.getElementById("details-panel").classList.remove("open");
        }

        // Funzioni di controllo zoom
        function resetZoom() {
            svg.transition().duration(750).call(
                zoom.transform,
                d3.zoomIdentity
            );
        }

        function zoomIn() {
            svg.transition().duration(300).call(
                zoom.scaleBy, 1.5
            );
        }

        function zoomOut() {
            svg.transition().duration(300).call(
                zoom.scaleBy, 1 / 1.5
            );
        }

        // Gestione responsive
        function handleResize() {
            const newWidth = window.innerWidth;
            const newHeight = window.innerHeight - 80;
            
            svg.attr("width", newWidth).attr("height", newHeight);
            simulation.force("center", d3.forceCenter(newWidth / 2, newHeight / 2));
            simulation.alpha(0.3).restart();
        }

        window.addEventListener("resize", handleResize);

        // Chiusura del pannello con ESC
        document.addEventListener("keydown", function(event) {
            if (event.key === "Escape") {
                closeDetails();
            }
        });

        // Effetti di hover per evidenziare collegamenti
        node.on("mouseover", function(event, d) {
            // Evidenzia i collegamenti collegati a questo nodo
            link.style("opacity", function(l) {
                return l.source === d || l.target === d ? 1 : 0.2;
            });
            
            // Evidenzia i nodi collegati
            node.style("opacity", function(n) {
                return n === d || data.links.some(l => 
                    (l.source === d && l.target === n) || 
                    (l.target === d && l.source === n)
                ) ? 1 : 0.3;
            });
        });

        node.on("mouseout", function() {
            link.style("opacity", null);
            node.style("opacity", null);
        });
    </script>
</body>
</html>